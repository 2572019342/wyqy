<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="wyqy.system.mapper.TranslationRecordMapper">
    
    <resultMap type="TranslationRecord" id="TranslationRecordResult">
        <result property="recordId"        column="record_id"        />
        <result property="requestId"       column="request_id"       />
        <result property="sourceText"      column="source_text"      />
        <result property="targetText"      column="target_text"      />
        <result property="sourceLanguage"  column="source_language"  />
        <result property="targetLanguage"  column="target_language"  />
        <result property="translationType" column="translation_type" />
        <result property="corpusUsed"      column="corpus_used"      />
        <result property="processingTime"  column="processing_time"  />
        <result property="confidenceScore" column="confidence_score" />
        <result property="userId"          column="user_id"          />
        <result property="userName"        column="user_name"        />
        <result property="ipAddress"       column="ip_address"       />
        <result property="browser"         column="browser"          />
        <result property="os"              column="os"               />
        <result property="status"          column="status"          />
        <result property="errorMessage"    column="error_message"    />
        <result property="delFlag"         column="del_flag"         />
        <result property="createTime"      column="create_time"      />
        <result property="remark"          column="remark"           />
    </resultMap>

    <sql id="selectTranslationRecordVo">
        select record_id, request_id, source_text, target_text, source_language, target_language, translation_type, corpus_used, processing_time, confidence_score, user_id, user_name, ip_address, browser, os, status, error_message, del_flag, create_time, remark from translation_record
    </sql>

    <select id="selectTranslationRecordList" parameterType="TranslationRecord" resultMap="TranslationRecordResult">
        <include refid="selectTranslationRecordVo"/>
        <where>  
            <if test="requestId != null  and requestId != ''"> and request_id like concat('%', #{requestId}, '%')</if>
            <if test="sourceText != null  and sourceText != ''"> and source_text like concat('%', #{sourceText}, '%')</if>
            <if test="targetText != null  and targetText != ''"> and target_text like concat('%', #{targetText}, '%')</if>
            <if test="sourceLanguage != null  and sourceLanguage != ''"> and source_language = #{sourceLanguage}</if>
            <if test="targetLanguage != null  and targetLanguage != ''"> and target_language = #{targetLanguage}</if>
            <if test="translationType != null  and translationType != ''"> and translation_type = #{translationType}</if>
            <if test="userId != null "> and user_id = #{userId}</if>
            <if test="userName != null  and userName != ''"> and user_name like concat('%', #{userName}, '%')</if>
            <if test="status != null  and status != ''"> and status = #{status}</if>
            <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
                and date_format(create_time,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
            </if>
            <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
                and date_format(create_time,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
            </if>
            and del_flag = '0'
        </where>
        order by create_time desc
    </select>
    
    <select id="selectTranslationRecordByRecordId" parameterType="Long" resultMap="TranslationRecordResult">
        <include refid="selectTranslationRecordVo"/>
        where record_id = #{recordId}
    </select>

    <select id="selectTranslationRecordByUserId" resultMap="TranslationRecordResult">
        <include refid="selectTranslationRecordVo"/>
        where user_id = #{userId} and del_flag = '0'
        order by create_time desc
        <if test="limit != null and limit > 0">
            limit #{limit}
        </if>
    </select>

    <select id="countTranslationByUserId" resultType="Long">
        select count(*) from translation_record 
        where user_id = #{userId} and del_flag = '0'
    </select>
        
    <insert id="insertTranslationRecord" parameterType="TranslationRecord" useGeneratedKeys="true" keyProperty="recordId">
        insert into translation_record
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="requestId != null and requestId != ''">request_id,</if>
            <if test="sourceText != null and sourceText != ''">source_text,</if>
            <if test="targetText != null and targetText != ''">target_text,</if>
            <if test="sourceLanguage != null">source_language,</if>
            <if test="targetLanguage != null">target_language,</if>
            <if test="translationType != null">translation_type,</if>
            <if test="corpusUsed != null">corpus_used,</if>
            <if test="processingTime != null">processing_time,</if>
            <if test="confidenceScore != null">confidence_score,</if>
            <if test="userId != null">user_id,</if>
            <if test="userName != null">user_name,</if>
            <if test="ipAddress != null">ip_address,</if>
            <if test="browser != null">browser,</if>
            <if test="os != null">os,</if>
            <if test="status != null">status,</if>
            <if test="errorMessage != null">error_message,</if>
            <if test="delFlag != null">del_flag,</if>
            <if test="createTime != null">create_time,</if>
            <if test="remark != null">remark,</if>
         </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="requestId != null and requestId != ''">#{requestId},</if>
            <if test="sourceText != null and sourceText != ''">#{sourceText},</if>
            <if test="targetText != null and targetText != ''">#{targetText},</if>
            <if test="sourceLanguage != null">#{sourceLanguage},</if>
            <if test="targetLanguage != null">#{targetLanguage},</if>
            <if test="translationType != null">#{translationType},</if>
            <if test="corpusUsed != null">#{corpusUsed},</if>
            <if test="processingTime != null">#{processingTime},</if>
            <if test="confidenceScore != null">#{confidenceScore},</if>
            <if test="userId != null">#{userId},</if>
            <if test="userName != null">#{userName},</if>
            <if test="ipAddress != null">#{ipAddress},</if>
            <if test="browser != null">#{browser},</if>
            <if test="os != null">#{os},</if>
            <if test="status != null">#{status},</if>
            <if test="errorMessage != null">#{errorMessage},</if>
            <if test="delFlag != null">#{delFlag},</if>
            <if test="createTime != null">#{createTime},</if>
            <if test="remark != null">#{remark},</if>
         </trim>
    </insert>

    <update id="updateTranslationRecord" parameterType="TranslationRecord">
        update translation_record
        <trim prefix="SET" suffixOverrides=",">
            <if test="requestId != null and requestId != ''">request_id = #{requestId},</if>
            <if test="sourceText != null and sourceText != ''">source_text = #{sourceText},</if>
            <if test="targetText != null and targetText != ''">target_text = #{targetText},</if>
            <if test="sourceLanguage != null">source_language = #{sourceLanguage},</if>
            <if test="targetLanguage != null">target_language = #{targetLanguage},</if>
            <if test="translationType != null">translation_type = #{translationType},</if>
            <if test="corpusUsed != null">corpus_used = #{corpusUsed},</if>
            <if test="processingTime != null">processing_time = #{processingTime},</if>
            <if test="confidenceScore != null">confidence_score = #{confidenceScore},</if>
            <if test="userId != null">user_id = #{userId},</if>
            <if test="userName != null">user_name = #{userName},</if>
            <if test="ipAddress != null">ip_address = #{ipAddress},</if>
            <if test="browser != null">browser = #{browser},</if>
            <if test="os != null">os = #{os},</if>
            <if test="status != null">status = #{status},</if>
            <if test="errorMessage != null">error_message = #{errorMessage},</if>
            <if test="delFlag != null">del_flag = #{delFlag},</if>
            <if test="createTime != null">create_time = #{createTime},</if>
            <if test="remark != null">remark = #{remark},</if>
        </trim>
        where record_id = #{recordId}
    </update>

    <delete id="deleteTranslationRecordByRecordId" parameterType="Long">
        update translation_record set del_flag = '2' where record_id = #{recordId}
    </delete>

    <delete id="deleteTranslationRecordByRecordIds" parameterType="String">
        update translation_record set del_flag = '2' where record_id in 
        <foreach item="recordId" collection="array" open="(" separator="," close=")">
            #{recordId}
        </foreach>
    </delete>

</mapper>
